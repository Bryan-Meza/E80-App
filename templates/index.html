{% extends "base.html" %} {% block title %}Electtric E80 - Dashboard{% endblock
%} {% block extra_css %}
<style>
  .unity-container {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .unity-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .unity-header h2 {
    color: #ffd700;
    margin-bottom: 10px;
  }

  .status-indicator {
    display: inline-block;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 14px;
    margin: 10px 0;
  }

  .status-connected {
    background-color: rgba(0, 255, 0, 0.2);
    color: #00ff00;
    border: 1px solid #00ff00;
  }

  .status-disconnected {
    background-color: rgba(255, 0, 0, 0.2);
    color: #ff0000;
    border: 1px solid #ff0000;
  }

  .latest-screenshot {
    margin-bottom: 30px;
    text-align: center;
  }

  .latest-screenshot img {
    max-width: 100%;
    max-height: 500px;
    border-radius: 10px;
    border: 2px solid #ffd700;
    display: block;
    margin: 0 auto;
  }

  .dashboard-grid {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 160px); /* Altura completa menos header y footer */
    padding: 20px;
    margin-left: 260px; /* Espacio para el sidebar */
  }

  .unity-section {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    max-width: 800px;
    width: 100%;
    margin: 0 auto;
  }
</style>
{% endblock %} {% block content %}
<div class="dashboard-grid">
  <!-- SecciÃ³n de Unity -->
  <section class="unity-section">
    <div class="unity-header">
      <h2><i class="fa-solid fa-video"></i> Unity Live Stream</h2>
      <div id="connectionStatus" class="status-indicator status-disconnected">
        <i class="fa-solid fa-circle"></i> Checking connection...
      </div>
    </div>

    <div id="latestScreenshot" class="latest-screenshot" style="display: none">
      <img id="latestImage" src="" alt="Live stream from Unity" />
      <p id="latestTimestamp" style="color: #00ff00; font-weight: bold"></p>
    </div>

    <div id="screenshotsContainer">
      <div class="no-screenshots">
        <i
          class="fa-solid fa-image"
          style="font-size: 48px; color: #666; margin-bottom: 20px"
        ></i>
        <p>No screenshots received yet.</p>
        <p>Make sure Unity is running and sending screenshots.</p>
      </div>
    </div>
  </section>
</div>
{% endblock %} {% block extra_js %}
<script>
  function formatTimestamp(timestamp) {
    const date = new Date(timestamp * 1000);
    return date.toLocaleString();
  }

  function updateConnectionStatus(connected) {
    const statusElement = document.getElementById("connectionStatus");
    if (connected) {
      statusElement.className = "status-indicator status-connected";
      statusElement.innerHTML =
        '<i class="fa-solid fa-circle"></i> Live Stream Active';
    } else {
      statusElement.className = "status-indicator status-disconnected";
      statusElement.innerHTML =
        '<i class="fa-solid fa-circle"></i> No Live Stream';
    }
  }

  function loadLiveStream() {
    fetch("/api/live-frame")
      .then((response) => response.json())
      .then((data) => {
        const latestContainer = document.getElementById("latestScreenshot");
        const container = document.getElementById("screenshotsContainer");

        if (data.live && data.frame) {
          updateConnectionStatus(true);

          const imgSrc = "data:image/jpeg;base64," + data.frame;
          document.getElementById("latestImage").src = imgSrc;
          document.getElementById(
            "latestTimestamp"
          ).textContent = `ðŸ”´ LIVE - ${new Date().toLocaleTimeString()}`;
          latestContainer.style.display = "block";
          container.style.display = "none";
        } else {
          updateConnectionStatus(false);
          latestContainer.style.display = "none";
          container.style.display = "block";
        }
      })
      .catch((error) => {
        updateConnectionStatus(false);
      });
  }

  document.addEventListener("DOMContentLoaded", loadLiveStream);
  setInterval(loadLiveStream, 100);
</script>
{% endblock %}
